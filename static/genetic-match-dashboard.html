<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Acasalamento Inteligente - Sistema de Haras</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .card-hover {
            transition: all 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <header class="gradient-bg text-white shadow-lg">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <i data-lucide="dna" class="w-8 h-8"></i>
                    <div>
                        <h1 class="text-2xl font-bold">Acasalamento Inteligente</h1>
                        <p class="text-blue-100">Genetic Match Engine - IA Preditiva</p>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <span class="text-sm">Haras São João</span>
                    <a href="dashboard-integrado.html" class="bg-white/20 hover:bg-white/30 px-4 py-2 rounded-lg transition-colors">
                        <i data-lucide="arrow-left" class="w-4 h-4 inline mr-2"></i>
                        Voltar ao Dashboard
                    </a>
                </div>
            </div>
        </div>
    </header>

    <div class="container mx-auto px-6 py-8">
        <!-- Seleção de Doadora -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
            <div class="flex items-center justify-between mb-6">
                <div class="flex items-center space-x-3">
                    <i data-lucide="heart" class="w-6 h-6 text-pink-500"></i>
                    <h2 class="text-xl font-semibold">Selecionar Doadora</h2>
                </div>
                <button id="refreshDoadoras" class="text-blue-600 hover:text-blue-800">
                    <i data-lucide="refresh-cw" class="w-5 h-5"></i>
                </button>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Doadora</label>
                    <select id="doadoraSelect" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <option value="">Selecione uma doadora...</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Categoria Objetivo</label>
                    <select id="categoriaSelect" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <option value="conformação">Conformação</option>
                        <option value="corrida">Corrida</option>
                        <option value="trabalho">Trabalho</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Orçamento Máximo (R$)</label>
                    <input type="number" id="orcamentoInput" value="25000" min="5000" max="100000" step="1000" 
                           class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
            </div>
            
            <div class="flex justify-center">
                <button id="gerarRecomendacoes" class="bg-gradient-to-r from-blue-600 to-purple-600 text-white px-8 py-3 rounded-lg font-semibold hover:from-blue-700 hover:to-purple-700 transition-all transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed">
                    <i data-lucide="brain" class="w-5 h-5 inline mr-2"></i>
                    Gerar Recomendações IA
                </button>
            </div>
        </div>

        <!-- Loading -->
        <div id="loadingSection" class="hidden bg-white rounded-xl shadow-lg p-8 mb-8 text-center">
            <div class="pulse-animation">
                <i data-lucide="brain" class="w-16 h-16 text-blue-500 mx-auto mb-4"></i>
                <h3 class="text-xl font-semibold text-gray-800 mb-2">Processando com IA...</h3>
                <p class="text-gray-600">Analisando genética, performance e ROI financeiro</p>
                <div class="mt-4">
                    <div class="bg-gray-200 rounded-full h-2 w-64 mx-auto">
                        <div class="bg-gradient-to-r from-blue-500 to-purple-500 h-2 rounded-full animate-pulse" style="width: 75%"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Informações da Doadora Selecionada -->
        <div id="doadoraInfo" class="hidden bg-white rounded-xl shadow-lg p-6 mb-8">
            <div class="flex items-center space-x-3 mb-4">
                <i data-lucide="info" class="w-6 h-6 text-blue-500"></i>
                <h3 class="text-lg font-semibold">Doadora Selecionada</h3>
            </div>
            <div id="doadoraDetails" class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <!-- Preenchido dinamicamente -->
            </div>
        </div>

        <!-- Ranking de Recomendações -->
        <div id="recomendacoesSection" class="hidden">
            <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
                <div class="flex items-center justify-between mb-6">
                    <div class="flex items-center space-x-3">
                        <i data-lucide="trophy" class="w-6 h-6 text-yellow-500"></i>
                        <h2 class="text-xl font-semibold">Ranking de Acasalamentos</h2>
                    </div>
                    <div class="flex items-center space-x-2 text-sm text-gray-600">
                        <i data-lucide="clock" class="w-4 h-4"></i>
                        <span id="tempoProcessamento">-</span>
                    </div>
                </div>
                
                <div id="rankingContainer" class="space-y-4">
                    <!-- Preenchido dinamicamente -->
                </div>
            </div>

            <!-- Análise Comparativa -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                <!-- Gráfico de Performance -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-lg font-semibold mb-4 flex items-center">
                        <i data-lucide="bar-chart-3" class="w-5 h-5 mr-2 text-green-500"></i>
                        Análise de Performance
                    </h3>
                    <canvas id="performanceChart" width="400" height="300"></canvas>
                </div>

                <!-- Gráfico de ROI -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-lg font-semibold mb-4 flex items-center">
                        <i data-lucide="trending-up" class="w-5 h-5 mr-2 text-blue-500"></i>
                        Análise de ROI
                    </h3>
                    <canvas id="roiChart" width="400" height="300"></canvas>
                </div>
            </div>

            <!-- Simulador de Cenários -->
            <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
                <div class="flex items-center space-x-3 mb-6">
                    <i data-lucide="calculator" class="w-6 h-6 text-purple-500"></i>
                    <h3 class="text-lg font-semibold">Simulador de Cenários</h3>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Garanhão para Simulação</label>
                        <select id="garanhaoSimulacao" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                            <option value="">Selecione um garanhão...</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Variação de Preço (%)</label>
                        <input type="range" id="variacaoPreco" min="-50" max="50" value="0" step="5" 
                               class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                        <div class="flex justify-between text-xs text-gray-500 mt-1">
                            <span>-50%</span>
                            <span id="precoValue">0%</span>
                            <span>+50%</span>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Variação de Custo (%)</label>
                        <input type="range" id="variacaoCusto" min="-30" max="30" value="0" step="5" 
                               class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                        <div class="flex justify-between text-xs text-gray-500 mt-1">
                            <span>-30%</span>
                            <span id="custoValue">0%</span>
                            <span>+30%</span>
                        </div>
                    </div>
                </div>
                
                <div class="mt-6 flex justify-center">
                    <button id="simularCenario" class="bg-purple-600 text-white px-6 py-2 rounded-lg hover:bg-purple-700 transition-colors disabled:opacity-50">
                        <i data-lucide="play" class="w-4 h-4 inline mr-2"></i>
                        Simular Cenário
                    </button>
                </div>
                
                <div id="resultadoSimulacao" class="hidden mt-6 p-4 bg-gray-50 rounded-lg">
                    <!-- Preenchido dinamicamente -->
                </div>
            </div>

            <!-- Ações Rápidas -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h3 class="text-lg font-semibold mb-4 flex items-center">
                    <i data-lucide="zap" class="w-5 h-5 mr-2 text-orange-500"></i>
                    Ações Rápidas
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <button class="flex items-center justify-center space-x-2 bg-green-50 text-green-700 p-4 rounded-lg hover:bg-green-100 transition-colors">
                        <i data-lucide="calendar-plus" class="w-5 h-5"></i>
                        <span>Agendar Protocolo</span>
                    </button>
                    <button class="flex items-center justify-center space-x-2 bg-blue-50 text-blue-700 p-4 rounded-lg hover:bg-blue-100 transition-colors">
                        <i data-lucide="file-text" class="w-5 h-5"></i>
                        <span>Gerar Relatório PDF</span>
                    </button>
                    <button class="flex items-center justify-center space-x-2 bg-purple-50 text-purple-700 p-4 rounded-lg hover:bg-purple-100 transition-colors">
                        <i data-lucide="share-2" class="w-5 h-5"></i>
                        <span>Compartilhar Análise</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Inicialização
        let doadoras = [];
        let garanhoes = [];
        let recomendacoesAtuais = [];

        // Elementos DOM
        const doadoraSelect = document.getElementById('doadoraSelect');
        const categoriaSelect = document.getElementById('categoriaSelect');
        const orcamentoInput = document.getElementById('orcamentoInput');
        const gerarBtn = document.getElementById('gerarRecomendacoes');
        const loadingSection = document.getElementById('loadingSection');
        const doadoraInfo = document.getElementById('doadoraInfo');
        const recomendacoesSection = document.getElementById('recomendacoesSection');
        const variacaoPreco = document.getElementById('variacaoPreco');
        const variacaoCusto = document.getElementById('variacaoCusto');
        const precoValue = document.getElementById('precoValue');
        const custoValue = document.getElementById('custoValue');

        // Carregar dados iniciais
        async function carregarDados() {
            try {
                // Simular dados (em produção, fazer chamadas reais para a API)
                doadoras = [
                    {
                        id: 1,
                        nome: 'Estrela Dourada',
                        raca: 'Mangalarga',
                        idade: 8.7,
                        peso: 445.0,
                        altura: 1.54,
                        taxa_prenhez_historica: 75.0,
                        score_genetico: 82.0,
                        tipo_morfologico: 'conformação'
                    },
                    {
                        id: 2,
                        nome: 'Bela Vista',
                        raca: 'Quarto de Milha',
                        idade: 6.3,
                        peso: 465.0,
                        altura: 1.56,
                        taxa_prenhez_historica: 68.0,
                        score_genetico: 78.0,
                        tipo_morfologico: 'corrida'
                    },
                    {
                        id: 3,
                        nome: 'Lua Cheia',
                        raca: 'Mangalarga',
                        idade: 10.9,
                        peso: 420.0,
                        altura: 1.52,
                        taxa_prenhez_historica: 85.0,
                        score_genetico: 88.0,
                        tipo_morfologico: 'trabalho'
                    }
                ];

                // Preencher select de doadoras
                doadoraSelect.innerHTML = '<option value="">Selecione uma doadora...</option>';
                doadoras.forEach(doadora => {
                    const option = document.createElement('option');
                    option.value = doadora.id;
                    option.textContent = `${doadora.nome} (${doadora.raca}, ${doadora.idade.toFixed(1)} anos)`;
                    doadoraSelect.appendChild(option);
                });

            } catch (error) {
                console.error('Erro ao carregar dados:', error);
            }
        }

        // Mostrar informações da doadora selecionada
        function mostrarInfoDoadora(doadoraId) {
            const doadora = doadoras.find(d => d.id == doadoraId);
            if (!doadora) return;

            const detailsContainer = document.getElementById('doadoraDetails');
            detailsContainer.innerHTML = `
                <div class="text-center">
                    <div class="text-2xl font-bold text-blue-600">${doadora.nome}</div>
                    <div class="text-sm text-gray-500">${doadora.raca}</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-semibold">${doadora.idade.toFixed(1)} anos</div>
                    <div class="text-sm text-gray-500">Idade</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-semibold">${doadora.taxa_prenhez_historica}%</div>
                    <div class="text-sm text-gray-500">Taxa Prenhez</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-semibold">${doadora.score_genetico}%</div>
                    <div class="text-sm text-gray-500">Score Genético</div>
                </div>
            `;

            doadoraInfo.classList.remove('hidden');
        }

        // Gerar recomendações
        async function gerarRecomendacoes() {
            const doadoraId = doadoraSelect.value;
            const categoria = categoriaSelect.value;
            const orcamento = parseInt(orcamentoInput.value);

            if (!doadoraId) {
                alert('Por favor, selecione uma doadora.');
                return;
            }

            // Mostrar loading
            loadingSection.classList.remove('hidden');
            recomendacoesSection.classList.add('hidden');
            gerarBtn.disabled = true;

            try {
                // Simular processamento
                await new Promise(resolve => setTimeout(resolve, 2000));

                // Dados simulados de recomendações
                const recomendacoes = [
                    {
                        ranking: 1,
                        garanhao: {
                            id: 103,
                            nome: 'Imperador',
                            raca: 'Mangalarga',
                            idade: 11.8,
                            valor_cobertura: 15000
                        },
                        predicoes: {
                            taxa_prenhez: 84.2,
                            score_genetico: 91.5,
                            roi_estimado: 67.3,
                            confianca: 89.2
                        },
                        financeiro: {
                            custo_estimado: 19500,
                            valor_potro_estimado: 85000,
                            lucro_esperado: 51070
                        },
                        justificativa: 'Acasalamento com probabilidade muito alta de prenhez (84.2%) e excelente ROI (67.3%). Performance esperada da progênie: 91.5%.',
                        fatores_positivos: [
                            'Doadora em idade reprodutiva ideal (8.7 anos)',
                            'Baixo coeficiente de consanguinidade',
                            'Alta expectativa de performance da progênie',
                            'Excelente ROI estimado (67.3%)',
                            'Perfeita compatibilidade racial'
                        ],
                        fatores_atencao: []
                    },
                    {
                        ranking: 2,
                        garanhao: {
                            id: 105,
                            nome: 'Majestoso',
                            raca: 'Mangalarga',
                            idade: 13.5,
                            valor_cobertura: 20000
                        },
                        predicoes: {
                            taxa_prenhez: 81.7,
                            score_genetico: 93.2,
                            roi_estimado: 58.9,
                            confianca: 91.5
                        },
                        financeiro: {
                            custo_estimado: 26000,
                            valor_potro_estimado: 95000,
                            lucro_esperado: 51615
                        },
                        justificativa: 'Acasalamento com probabilidade alta de prenhez (81.7%) e bom ROI (58.9%). Excelente score genético (93.2%).',
                        fatores_positivos: [
                            'Doadora em idade reprodutiva ideal (8.7 anos)',
                            'Garanhão em idade reprodutiva ativa (13.5 anos)',
                            'Baixo coeficiente de consanguinidade',
                            'Alta expectativa de performance da progênie',
                            'Perfeita compatibilidade racial'
                        ],
                        fatores_atencao: []
                    },
                    {
                        ranking: 3,
                        garanhao: {
                            id: 101,
                            nome: 'Trovão Negro',
                            raca: 'Mangalarga',
                            idade: 12.4,
                            valor_cobertura: 8000
                        },
                        predicoes: {
                            taxa_prenhez: 78.5,
                            score_genetico: 85.7,
                            roi_estimado: 89.2,
                            confianca: 87.3
                        },
                        financeiro: {
                            custo_estimado: 10400,
                            valor_potro_estimado: 72000,
                            lucro_esperado: 46120
                        },
                        justificativa: 'Acasalamento com probabilidade alta de prenhez (78.5%) e excelente ROI (89.2%). Boa relação custo-benefício.',
                        fatores_positivos: [
                            'Doadora em idade reprodutiva ideal (8.7 anos)',
                            'Garanhão em idade reprodutiva ativa (12.4 anos)',
                            'Baixo coeficiente de consanguinidade',
                            'Excelente ROI estimado (89.2%)',
                            'Perfeita compatibilidade racial'
                        ],
                        fatores_atencao: []
                    }
                ];

                recomendacoesAtuais = recomendacoes;
                mostrarRecomendacoes(recomendacoes);
                criarGraficos(recomendacoes);
                preencherSimulador(recomendacoes);

                document.getElementById('tempoProcessamento').textContent = '1.8s';

            } catch (error) {
                console.error('Erro ao gerar recomendações:', error);
                alert('Erro ao gerar recomendações. Tente novamente.');
            } finally {
                loadingSection.classList.add('hidden');
                gerarBtn.disabled = false;
            }
        }

        // Mostrar recomendações
        function mostrarRecomendacoes(recomendacoes) {
            const container = document.getElementById('rankingContainer');
            container.innerHTML = '';

            recomendacoes.forEach(rec => {
                const card = document.createElement('div');
                card.className = 'bg-gradient-to-r from-white to-gray-50 rounded-lg p-6 border-l-4 border-blue-500 card-hover';
                
                const medalColor = rec.ranking === 1 ? 'text-yellow-500' : rec.ranking === 2 ? 'text-gray-400' : 'text-orange-500';
                
                card.innerHTML = `
                    <div class="flex items-start justify-between mb-4">
                        <div class="flex items-center space-x-3">
                            <div class="flex items-center justify-center w-8 h-8 rounded-full bg-blue-100 text-blue-600 font-bold">
                                ${rec.ranking}
                            </div>
                            <div>
                                <h4 class="text-lg font-semibold text-gray-800">${rec.garanhao.nome}</h4>
                                <p class="text-sm text-gray-600">${rec.garanhao.raca} • ${rec.garanhao.idade.toFixed(1)} anos • R$ ${rec.garanhao.valor_cobertura.toLocaleString()}</p>
                            </div>
                        </div>
                        <i data-lucide="medal" class="w-6 h-6 ${medalColor}"></i>
                    </div>
                    
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4">
                        <div class="text-center p-3 bg-green-50 rounded-lg">
                            <div class="text-xl font-bold text-green-600">${rec.predicoes.taxa_prenhez}%</div>
                            <div class="text-xs text-gray-600">Taxa Prenhez</div>
                        </div>
                        <div class="text-center p-3 bg-blue-50 rounded-lg">
                            <div class="text-xl font-bold text-blue-600">${rec.predicoes.score_genetico}%</div>
                            <div class="text-xs text-gray-600">Score Genético</div>
                        </div>
                        <div class="text-center p-3 bg-purple-50 rounded-lg">
                            <div class="text-xl font-bold text-purple-600">${rec.predicoes.roi_estimado}%</div>
                            <div class="text-xs text-gray-600">ROI Estimado</div>
                        </div>
                        <div class="text-center p-3 bg-orange-50 rounded-lg">
                            <div class="text-xl font-bold text-orange-600">R$ ${rec.financeiro.lucro_esperado.toLocaleString()}</div>
                            <div class="text-xs text-gray-600">Lucro Esperado</div>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <p class="text-sm text-gray-700 mb-2">${rec.justificativa}</p>
                        <div class="flex items-center space-x-2 text-xs">
                            <span class="bg-green-100 text-green-800 px-2 py-1 rounded">Confiança: ${rec.predicoes.confianca}%</span>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-xs">
                        <div>
                            <h5 class="font-semibold text-green-700 mb-1">Fatores Positivos:</h5>
                            <ul class="space-y-1">
                                ${rec.fatores_positivos.slice(0, 3).map(fator => `<li class="flex items-start"><i data-lucide="check" class="w-3 h-3 text-green-500 mr-1 mt-0.5 flex-shrink-0"></i><span>${fator}</span></li>`).join('')}
                            </ul>
                        </div>
                        <div>
                            <h5 class="font-semibold text-gray-700 mb-1">Análise Financeira:</h5>
                            <div class="space-y-1">
                                <div>Custo Total: R$ ${rec.financeiro.custo_estimado.toLocaleString()}</div>
                                <div>Valor Potro: R$ ${rec.financeiro.valor_potro_estimado.toLocaleString()}</div>
                                <div class="font-semibold text-green-600">Lucro: R$ ${rec.financeiro.lucro_esperado.toLocaleString()}</div>
                            </div>
                        </div>
                    </div>
                `;
                
                container.appendChild(card);
            });

            recomendacoesSection.classList.remove('hidden');
        }

        // Criar gráficos
        function criarGraficos(recomendacoes) {
            // Gráfico de Performance
            const performanceCtx = document.getElementById('performanceChart').getContext('2d');
            new Chart(performanceCtx, {
                type: 'radar',
                data: {
                    labels: ['Taxa Prenhez', 'Score Genético', 'ROI', 'Confiança'],
                    datasets: recomendacoes.slice(0, 3).map((rec, index) => ({
                        label: rec.garanhao.nome,
                        data: [
                            rec.predicoes.taxa_prenhez,
                            rec.predicoes.score_genetico,
                            rec.predicoes.roi_estimado,
                            rec.predicoes.confianca
                        ],
                        borderColor: ['#3B82F6', '#10B981', '#8B5CF6'][index],
                        backgroundColor: ['#3B82F620', '#10B98120', '#8B5CF620'][index],
                        borderWidth: 2
                    }))
                },
                options: {
                    responsive: true,
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 100
                        }
                    }
                }
            });

            // Gráfico de ROI
            const roiCtx = document.getElementById('roiChart').getContext('2d');
            new Chart(roiCtx, {
                type: 'bar',
                data: {
                    labels: recomendacoes.map(rec => rec.garanhao.nome),
                    datasets: [{
                        label: 'ROI Estimado (%)',
                        data: recomendacoes.map(rec => rec.predicoes.roi_estimado),
                        backgroundColor: 'rgba(59, 130, 246, 0.8)',
                        borderColor: 'rgba(59, 130, 246, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // Preencher simulador
        function preencherSimulador(recomendacoes) {
            const select = document.getElementById('garanhaoSimulacao');
            select.innerHTML = '<option value="">Selecione um garanhão...</option>';
            
            recomendacoes.forEach(rec => {
                const option = document.createElement('option');
                option.value = rec.garanhao.id;
                option.textContent = `${rec.garanhao.nome} (ROI: ${rec.predicoes.roi_estimado}%)`;
                option.dataset.recomendacao = JSON.stringify(rec);
                select.appendChild(option);
            });
        }

        // Simular cenário
        async function simularCenario() {
            const garanhaoId = document.getElementById('garanhaoSimulacao').value;
            const varPreco = parseInt(variacaoPreco.value) / 100;
            const varCusto = parseInt(variacaoCusto.value) / 100;

            if (!garanhaoId) {
                alert('Selecione um garanhão para simulação.');
                return;
            }

            const select = document.getElementById('garanhaoSimulacao');
            const selectedOption = select.options[select.selectedIndex];
            const recomendacao = JSON.parse(selectedOption.dataset.recomendacao);

            // Calcular cenário simulado
            const novoValorPotro = recomendacao.financeiro.valor_potro_estimado * (1 + varPreco);
            const novoCusto = recomendacao.financeiro.custo_estimado * (1 + varCusto);
            const novaReceita = novoValorPotro * (recomendacao.predicoes.taxa_prenhez / 100);
            const novoROI = ((novaReceita - novoCusto) / novoCusto) * 100;
            const novoLucro = novaReceita - novoCusto;

            const resultadoDiv = document.getElementById('resultadoSimulacao');
            resultadoDiv.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <h4 class="font-semibold text-gray-800 mb-3">Cenário Base</h4>
                        <div class="space-y-2 text-sm">
                            <div class="flex justify-between">
                                <span>ROI:</span>
                                <span class="font-semibold">${recomendacao.predicoes.roi_estimado}%</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Valor Potro:</span>
                                <span>R$ ${recomendacao.financeiro.valor_potro_estimado.toLocaleString()}</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Custo Total:</span>
                                <span>R$ ${recomendacao.financeiro.custo_estimado.toLocaleString()}</span>
                            </div>
                            <div class="flex justify-between border-t pt-2">
                                <span>Lucro:</span>
                                <span class="font-semibold text-green-600">R$ ${recomendacao.financeiro.lucro_esperado.toLocaleString()}</span>
                            </div>
                        </div>
                    </div>
                    <div>
                        <h4 class="font-semibold text-gray-800 mb-3">Cenário Simulado</h4>
                        <div class="space-y-2 text-sm">
                            <div class="flex justify-between">
                                <span>ROI:</span>
                                <span class="font-semibold ${novoROI > recomendacao.predicoes.roi_estimado ? 'text-green-600' : 'text-red-600'}">${novoROI.toFixed(1)}%</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Valor Potro:</span>
                                <span>R$ ${novoValorPotro.toLocaleString()}</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Custo Total:</span>
                                <span>R$ ${novoCusto.toLocaleString()}</span>
                            </div>
                            <div class="flex justify-between border-t pt-2">
                                <span>Lucro:</span>
                                <span class="font-semibold ${novoLucro > recomendacao.financeiro.lucro_esperado ? 'text-green-600' : 'text-red-600'}">R$ ${novoLucro.toLocaleString()}</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="mt-4 p-3 bg-blue-50 rounded-lg">
                    <h5 class="font-semibold text-blue-800 mb-2">Impacto da Simulação</h5>
                    <div class="text-sm text-blue-700">
                        <div>Diferença no ROI: <span class="font-semibold">${(novoROI - recomendacao.predicoes.roi_estimado).toFixed(1)}%</span></div>
                        <div>Diferença no Lucro: <span class="font-semibold">R$ ${(novoLucro - recomendacao.financeiro.lucro_esperado).toLocaleString()}</span></div>
                    </div>
                </div>
            `;
            
            resultadoDiv.classList.remove('hidden');
        }

        // Event Listeners
        doadoraSelect.addEventListener('change', (e) => {
            if (e.target.value) {
                mostrarInfoDoadora(parseInt(e.target.value));
            } else {
                doadoraInfo.classList.add('hidden');
            }
        });

        gerarBtn.addEventListener('click', gerarRecomendacoes);

        variacaoPreco.addEventListener('input', (e) => {
            precoValue.textContent = `${e.target.value}%`;
        });

        variacaoCusto.addEventListener('input', (e) => {
            custoValue.textContent = `${e.target.value}%`;
        });

        document.getElementById('simularCenario').addEventListener('click', simularCenario);

        // Inicializar ícones Lucide
        lucide.createIcons();

        // Carregar dados ao inicializar
        carregarDados();
    </script>
</body>
</html>
